<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Youth Online</title>
<style>
  body {
    margin: 0;
    background: #222;
    overflow: hidden;
    touch-action: none;
  }
  canvas {
    display: block;
    background: url('background.png') repeat;
  }
  /* 조이스틱 베이스 */
  .joystick-base {
    position: absolute;
    width: 120px;
    height: 120px;
    background: rgba(255,255,255,0.1);
    border-radius: 50%;
    pointer-events: none;
    display: none;
  }
  /* 조이스틱 스틱 */
  .joystick-stick {
    position: absolute;
    width: 60px;
    height: 60px;
    background: rgba(255,255,255,0.4);
    border-radius: 50%;
    pointer-events: none;
    left: 30px;
    top: 30px;
  }
  /* 오토 버튼 */
  #autohunt {
    position: absolute;
    bottom: 50px;
    right: 50px;
    padding: 15px 20px;
    background: rgba(255,255,255,0.3);
    color: #fff;
    font-size: 18px;
    border-radius: 10px;
    border: 1px solid #fff;
    cursor: pointer;
    user-select: none;
    z-index: 999;
  }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<!-- 조이스틱 -->
<div id="joystickBase" class="joystick-base">
  <div id="joystickStick" class="joystick-stick"></div>
</div>

<!-- 오토 버튼 -->
<div id="autohunt">Auto</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let player = { x: 200, y: 200, size: 40, speed: 3, dx: 0, dy: 0 };
let autoHunt = false;

// 플레이어 그리기
function drawPlayer() {
  ctx.fillStyle = 'yellow';
  ctx.fillRect(player.x, player.y, player.size, player.size);
}

// 화면 지우기
function clear() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
}

// 게임 루프
function update() {
  clear();

  if (autoHunt) {
    player.x += Math.sin(Date.now()/200) * 1.5;
    player.y += Math.cos(Date.now()/200) * 1.5;
  } else {
    player.x += player.dx;
    player.y += player.dy;
  }

  drawPlayer();
  requestAnimationFrame(update);
}

// --------------------- 조이스틱 로직 ---------------------
const joystickBase = document.getElementById('joystickBase');
const joystickStick = document.getElementById('joystickStick');
let joyActive = false;
let joyStart = {x:0, y:0};

document.addEventListener('touchstart', e => {
  // 버튼 영역 누르면 조이스틱 무시
  if (e.target.closest('#autohunt')) {
    return;
  }

  const touch = e.touches[0];
  joyActive = true;
  joyStart = { x: touch.clientX, y: touch.clientY };

  joystickBase.style.left = (joyStart.x - 60) + 'px';
  joystickBase.style.top = (joyStart.y - 60) + 'px';
  joystickBase.style.display = 'block';

  e.preventDefault();
}, {passive:false});

document.addEventListener('touchmove', e => {
  if (!joyActive) return;
  const touch = e.touches[0];
  const dx = touch.clientX - joyStart.x;
  const dy = touch.clientY - joyStart.y;

  const distance = Math.sqrt(dx*dx + dy*dy);
  const maxDistance = 50;
  const limitedDist = Math.min(distance, maxDistance);
  const angle = Math.atan2(dy, dx);

  joystickStick.style.left = `${30 + Math.cos(angle) * limitedDist}px`;
  joystickStick.style.top = `${30 + Math.sin(angle) * limitedDist}px`;

  // 손가락 위치에 따라 조이스틱 전체 이동
  joystickBase.style.left = (touch.clientX - 60) + 'px';
  joystickBase.style.top = (touch.clientY - 60) + 'px';

  player.dx = Math.cos(angle) * player.speed * (limitedDist / maxDistance);
  player.dy = Math.sin(angle) * player.speed * (limitedDist / maxDistance);

  e.preventDefault();
}, {passive:false});

document.addEventListener('touchend', e => {
  joyActive = false;
  joystickBase.style.display = 'none';
  joystickStick.style.left = '30px';
  joystickStick.style.top = '30px';
  player.dx = 0;
  player.dy = 0;
  e.preventDefault();
}, {passive:false});

// --------------------- 오토 버튼 ---------------------
document.getElementById('autohunt').addEventListener('touchstart', e => {
  autoHunt = !autoHunt;
  document.getElementById('autohunt').style.background = autoHunt
    ? 'rgba(0,255,0,0.3)'
    : 'rgba(255,255,255,0.3)';
  e.stopPropagation(); // 조이스틱 이벤트로 안 넘어가게 함
  e.preventDefault();
}, {passive:false});

update();
</script>
</body>
</html>
